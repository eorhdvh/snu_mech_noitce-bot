name: Check SNU ME Notice

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

# [í•„ìˆ˜] ë´‡ì´ ì €ì¥ì†Œì— íŒŒì¼ì„ ì“¸ ìˆ˜ ìˆëŠ” ê¶Œí•œ ë¶€ì—¬
permissions:
  contents: write

jobs:
  check-notice:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # âŒ ê¸°ì¡´ì˜ 'Cache last notice file' ë‹¨ê³„ëŠ” ì‚­ì œí–ˆìŠµë‹ˆë‹¤.
      # ìºì‹œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì²˜ëŸ¼ ì‹¤ì‹œê°„ ë³€ë™ ì‚¬í•­ì„ ì €ì¥í•˜ëŠ” ë° ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

      - name: Install dependencies
        run: pip install requests beautifulsoup4

      - name: Run notice bot
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        # ğŸ’¡ ì‚¬ìš©ìë¶„ì˜ íŒŒì¼ëª…(notice_bot.py)ì— ë§ì·„ìŠµë‹ˆë‹¤.
        run: python notice_bot.py

      # âœ… [í•µì‹¬ ìˆ˜ì •] ë³€ê²½ëœ íŒŒì¼ì„ ìºì‹œê°€ ì•„ë‹Œ ì €ì¥ì†Œì— ì§ì ‘ ì €ì¥í•©ë‹ˆë‹¤.
      - name: Commit and push if changed
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          
          # íŒŒì¼ì´ ì¡´ì¬í•  ê²½ìš°ì—ë§Œ add (ìµœì´ˆ ì‹¤í–‰ ì—ëŸ¬ ë°©ì§€)
          if [ -f last_notice.txt ]; then
            git add last_notice.txt
            # ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸ í›„ ì»¤ë°‹ & í‘¸ì‹œ
            git diff --quiet && git diff --staged --quiet || (git commit -m "Update last notice [skip ci]" && git push)
          fi

      # âœ… 60ì¼ ë’¤ ì›Œí¬í”Œë¡œìš°ê°€ ìë™ìœ¼ë¡œ ë©ˆì¶”ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.
      - name: Keepalive Workflow
        uses: gautamkrishnar/keepalive-workflow@v1
